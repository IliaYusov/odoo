<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="action_dms_document_form" model="ir.actions.act_window">
        <field name="name">Documents</field>
        <field name="res_model">dms.document</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[("is_hidden", "=", False)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add a new Document.
            </p>
        </field>
    </record>

    <record id="dms_document_view_search" model="ir.ui.view">
        <field name="name">dms.document.search</field>
        <field name="model">dms.document</field>
        <field name="arch" type="xml">
            <search string="Documents">
                <field name="name" string="Document"/>
                <field name="create_uid" string="Created by"/>
                <filter name="filter_my_documents" string="My Documents" domain="[('create_uid', '=', uid)]"/>
                <separator/>
                <filter name="filter_pdf_doc" string="PDF/Document" domain="['|', ('mimetype', 'ilike', 'pdf'), ('name', 'ilike', '.doc')]"/>
                <filter name="filter_img_video" string="Image/Video" domain="['|', ('mimetype', 'ilike', 'image'), ('mimetype', 'ilike', 'video')]"/>
                <separator/>
                <filter name="filter_locked" string="Locked" domain="['|', ('locker_id', '=', uid), ('locker_id', '!=', False)]"/>
                <separator/>
                <filter name="filter_archived" string="Archived" domain="[('active', '=', False)]"/>
                <group expand="0" string="Group By">
                    <filter name="by_model" string="Model" domain="[]" context="{'group_by': 'res_model'}"/>
                    <filter name="creation_month" string="Creation Date" domain="[]" context="{'group_by':'create_date'}"/>
                </group>
                <searchpanel>
                    <field name="directory_id" icon="fa-folder" limit="0" operator="=" enable_counters="1"/>
<!--                    <field name="res_model" select="multi" string="Attached To" icon="fa-file-text" color="#338FFC" enable_counters="1"/>-->
                </searchpanel>
            </search>
        </field>
    </record>

    <record id="dms_document_view_kanban" model="ir.ui.view">
        <field name="name">dms.document.kanban</field>
        <field name="model">dms.document</field>
        <field name="arch" type="xml">
            <kanban js_class="document_kanban"
                    class="dms_document_kanban_view o_kanban_small_column align-content-start" create="false">
                <field name="id"/>
                <field name="name"/>
                <field name="active"/>
                <field name="mimetype"/>
                <field name="create_uid"/>
                <field name="write_date"/>
                <field name="locker_id"/>
                <field name="is_locked"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click">
                            <div class="o_dropdown_kanban dropdown">
                                <a
                                    class="dropdown-toggle o-no-caret btn"
                                    href="#"
                                    role="button"
                                    data-toggle="dropdown"
                                    aria-label="Dropdown menu"
                                    title="Dropdown menu"
                                >
                                    <span class="fa fa-ellipsis-v" />
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <div class="row">
                                        <div class="col-6 dms_document_kanban_operations">
                                            <h6 class="dropdown-header">
                                                Operations
                                            </h6>
<!--                                            <a-->
<!--                                                t-if="record.permission_write.raw_value and !record.is_locked.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                name="lock"-->
<!--                                                type="object"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-lock" />-->
<!--                                                Lock-->
<!--                                            </a>-->
<!--                                            <a-->
<!--                                                t-if="record.is_locked.raw_value  and record.is_lock_editor.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                name="unlock"-->
<!--                                                type="object"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-unlock-alt" />-->
<!--                                                Unlock-->
<!--                                            </a>-->
<!--                                            <a-->
<!--                                                t-if="record.permission_write.raw_value and record.active.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                name="toggle_active"-->
<!--                                                type="object"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-archive" />-->
<!--                                                Archive-->
<!--                                            </a>-->
<!--                                            <a-->
<!--                                                t-if="record.permission_write.raw_value and !record.active.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                name="toggle_active"-->
<!--                                                type="object"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-archive" />-->
<!--                                                Unarchive-->
<!--                                            </a>-->
                                            <a role="menuitem" class="dropdown-item"
                                               t-attf-href="/web/content?id=#{record.id.raw_value}&amp;field=datas&amp;model=dms.document&amp;filename_field=name&amp;download=true">
                                                <i class="fa fa-download"/>
                                                Download
                                            </a>
                                        </div>
<!--                                        <div-->
<!--                                            class="col-6 border-left mk_file_kanban_actions"-->
<!--                                        >-->
<!--                                            <h6 class="dropdown-header">-->
<!--                                                Actions-->
<!--                                            </h6>-->
<!--                                            <a-->
<!--                                                role="menuitem"-->
<!--                                                type="open"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-external-link" />-->
<!--                                                Open-->
<!--                                            </a>-->
<!--                                            <a-->
<!--                                                t-if="record.permission_write.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                type="edit"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-pencil-square-o" />-->
<!--                                                Edit-->
<!--                                            </a>-->
<!--                                            <a-->
<!--                                                t-if="record.permission_unlink.raw_value"-->
<!--                                                role="menuitem"-->
<!--                                                type="delete"-->
<!--                                                class="dropdown-item"-->
<!--                                            >-->
<!--                                                <i class="fa fa-trash-o" />-->
<!--                                                Delete-->
<!--                                            </a>-->
<!--                                        </div>-->
                                    </div>
                                </div>
                            </div>
                            <div class="oe_kanban_content">
                                <div class="o_kanban_image">
                                    <div class="o_kanban_image_wrapper">
                                        <t t-set="webimage" t-value="new RegExp('image.*(gif|jpeg|jpg|png)').test(record.mimetype.value)"/>
                                        <img t-if="webimage" t-attf-src="/web/image/#{record.id.raw_value}" width="60" height="60" alt="Document" class="o_attachment_image"/>
                                        <div t-else="!webimage" class="o_image o_image_thumbnail" t-att-data-mimetype="record.mimetype.value"/>
                                    </div>
                                </div>
                                <div class="o_kanban_details">
                                    <div class="o_kanban_details_wrapper">
                                        <div class="o_kanban_record_title o_text_overflow">
                                            <field name="name"/>
                                        </div>
                                        <div class="o_kanban_record_bottom">
                                            <div class="oe_kanban_bottom_left">
                                                <field name="write_date" widget="datetime"/>
                                            </div>
                                            <div class="oe_kanban_bottom_right">
                                                <span t-if="record.is_locked.raw_value" class="dms_document_kanban_lock">
                                                    <i t-attf-class="fa #{(record.is_locked.raw_value and !record.is_lock_editor.raw_value) ? 'fa-lock' : ''} #{((record.is_locked.raw_value and record.is_locker_editor.raw_value)) ? 'fa-unlock-alt' : ''}"
                                                       t-att-title="record.locker_id.value"/>
                                                </span>
                                                <img
                                                    t-att-src="kanban_image('res.users', 'image_128', record.create_uid.raw_value)"
                                                    t-att-alt="record.create_uid.value"
                                                    class="oe_kanban_avatar"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="dms_document_view_form" model="ir.ui.view">
        <field name="name">dms.document.form</field>
        <field name="model">dms.document</field>
        <field name="priority" eval="1"/>
        <field name="arch" type="xml">
            <form create="false">
                <sheet>
                    <group invisible="1">
                        <field name="is_locked" invisible="1"/>
                        <field name="active" invisible="1"/>
                        <field name="res_id" invisible="1"/>
                        <field name="res_model" invisible="1"/>
                    </group>
                    <div class="oe_button_box" name="button_box">
                        <button name="open_resource" type="object" class="oe_stat_button" icon="fa-external-link"
                                attrs="{'invisible': ['|', ('res_id', '=', False), ('res_model', 'in', [False, 'dms.document'])]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Related
                                    <br/>
                                    Record
                                </span>
                            </div>
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                    <field name="thumbnail" nolabel="1" widget="image" class="oe_avatar"
                           options="{&quot;preview_image&quot;:&quot;thumbnail&quot;}"
                           attrs="{'invisible': [('thumbnail', '=', False)]}"/>
                    <div class="oe_title" aria-label="Name">
                        <h1>
                            <field name="name" class="oe_inline" placeholder="Document Name" attrs="{'readonly': [('is_locked', '=', True)]}" required="True"/>&amp;nbsp;
                            <i class="fa fa-lock oe_inline" title="Locked" attrs="{'invisible': [('locker_id', '=', False)]}"/>
                        </h1>
                    </div>
                    <group name="content">
                        <field name="datas" filename="name" mimetype="mimetype" widget="preview_binary"/>
                    </group>
                    <group>
                        <group>
                            <field name="directory_id" attrs="{'readonly': [('is_locked', '=', True)]}"/>
                            <field name="storage_id" options="{'no_create_edit': True}" groups="dms.group_dms_manager" />
                        </group>
                        <group>
                            <field name="create_date"/>
                            <field name="create_uid"/>
                            <field name="locker_id" readonly="1" attrs="{'invisible': [('locker_id', '=', False)]}"/>
                        </group>
                    </group>
                    <group name="description_group" string="Description" colspan="4">
                        <field name="description" nolabel="1" colspan="2"/>
                    </group>
                    <group groups="base.group_no_one">
                        <field name="company_id" groups="base.group_multi_company"/>
                        <field name="size"/>
                        <field name="mimetype"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="dms_document_view_tree" model="ir.ui.view">
        <field name="name">dms.document.tree</field>
        <field name="model">dms.document</field>
        <field name="arch" type="xml">
            <tree>
                <field name="id" optional="hide" groups="base.group_no_one"/>
                <field name="name" string="Document" required="True"/>
                <field name="locker_id" optional="hide"/>
                <field name="create_date" widget="datetime"/>
            </tree>
        </field>
    </record>
</odoo>
